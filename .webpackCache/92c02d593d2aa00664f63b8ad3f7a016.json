{"remainingRequest":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js!C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\user\\userService.ts","dependencies":[{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\user\\userService.ts","mtime":1704481060455},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KdmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgew0KICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7DQogICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykgew0KICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsNCiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkNCiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdDsNCiAgICB9Ow0KICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KfTsNCnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfQ0KICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH0NCiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgIH0pOw0KfTsNCnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7DQogICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZzsNCiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgInRocm93IjogdmVyYigxKSwgInJldHVybiI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZzsNCiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH0NCiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7DQogICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuIik7DQogICAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7DQogICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5WyJyZXR1cm4iXSA6IG9wWzBdID8geVsidGhyb3ciXSB8fCAoKHQgPSB5WyJyZXR1cm4iXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7DQogICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07DQogICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7DQogICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTsNCiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7DQogICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7DQogICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfQ0KICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsNCiAgICB9DQp9Ow0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCmV4cG9ydHMudXNlclNlcnZpY2UgPSB2b2lkIDA7DQp2YXIgaGFzaF8xID0gcmVxdWlyZSgiQC9saWIvaGFzaCIpOw0KdmFyIGp3dF8xID0gcmVxdWlyZSgiQC9saWIvand0Iik7DQp2YXIgdXNlck1vZGVsXzEgPSByZXF1aXJlKCJAL21vZGVscy91c2VyTW9kZWwiKTsNCnZhciB1c2VyRXJyb3JzXzEgPSByZXF1aXJlKCIuL3VzZXJFcnJvcnMiKTsNCnZhciBuYW5vaWRfMSA9IHJlcXVpcmUoIm5hbm9pZCIpOw0KdmFyIGNyZWF0ZSA9IGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBwYXNzSGFzaCwgZW1haWwsIHVzZXIsIHVzZXJEYjsNCiAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICBwYXNzSGFzaCA9IGhhc2hfMS5oYXNoLmVuY29kZShkYXRhLnBhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICBlbWFpbCA9IGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGF0YS5lbWFpbDsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBmaW5kQnlFbWFpbChlbWFpbCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIGlmIChfYS5zZW50KCkpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdXNlckVycm9yc18xLnVzZXJFcnJvcnMudW5pcXVlRW1haWxFcnJvcihlbWFpbCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHVzZXJNb2RlbF8xLlVzZXIuY3JlYXRlKF9fYXNzaWduKF9fYXNzaWduKHt9LCBkYXRhKSwgeyBwYXNzd29yZDogcGFzc0hhc2ggfSkpXTsNCiAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICB1c2VyID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIHVzZXJEYiA9IHVzZXIudG9PYmplY3QoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdXNlckRiXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQp2YXIgZmluZEJ5RW1haWwgPSBmdW5jdGlvbiAoZW1haWwpIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgew0KICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHVzZXJNb2RlbF8xLlVzZXIuZmluZE9uZSh7DQogICAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbA0KICAgICAgICAgICAgICAgIH0pXTsNCiAgICAgICAgICAgIGNhc2UgMTogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIF9hLnNlbnQoKV07DQogICAgICAgIH0NCiAgICB9KTsNCn0pOyB9Ow0KdmFyIGZpbmRCeUlkID0gZnVuY3Rpb24gKHVzZXJJZCkgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgdXNlcjsNCiAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgdXNlck1vZGVsXzEuVXNlci5maW5kQnlJZCh1c2VySWQpXTsNCiAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICB1c2VyID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIGlmICghdXNlcikgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyB1c2VyRXJyb3JzXzEudXNlckVycm9ycy5idWlsZFVzZXJOb3RGb3VuZEVycm9yKHVzZXJJZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB1c2VyXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQp2YXIgY3JlYXRlVG9rZW4gPSBmdW5jdGlvbiAodXNlcklkKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGp3dF8xLmp3dC5jcmVhdGUoeyB1c2VyX2lkOiB1c2VySWQgfSldOw0KfSk7IH0pOyB9Ow0KdmFyIHVzZXJTZXJ2aWNlID0gew0KICAgIGNyZWF0ZTogY3JlYXRlLA0KICAgIGZpbmRCeUlkOiBmaW5kQnlJZCwNCiAgICBjcmVhdGVUb2tlbjogY3JlYXRlVG9rZW4sDQogICAgZmluZEJ5RW1haWw6IGZpbmRCeUVtYWlsLA0KICAgIGN1c3RvbUFscGhhYmV0OiBuYW5vaWRfMS5jdXN0b21BbHBoYWJldA0KfTsNCmV4cG9ydHMudXNlclNlcnZpY2UgPSB1c2VyU2VydmljZTsNCg=="},{"version":3,"file":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\user\\userService.ts","sourceRoot":"","sources":["C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\user\\userService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mCAAiC;AACjC,iCAA+B;AAC/B,gDAAyC;AAEzC,2CAAyC;AACzC,iCAAuC;AAEvC,IAAM,MAAM,GAAG,UAAO,IAAW;;;;;gBACzB,QAAQ,GAAG,WAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;gBAErC,KAAK,GAAG,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,CAAA;gBACrB,qBAAM,WAAW,CAAC,KAAK,CAAC,EAAA;;gBAA5B,IAAI,SAAwB,EAAE;oBAC5B,MAAM,uBAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAA;iBACzC;gBAEY,qBAAM,gBAAI,CAAC,MAAM,uBACzB,IAAI,KACP,QAAQ,EAAE,QAAQ,IAClB,EAAA;;gBAHI,IAAI,GAAG,SAGX;gBAEI,MAAM,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAA;gBAE9B,sBAAO,MAAM,EAAA;;;KACd,CAAA;AAED,IAAM,WAAW,GAAG,UAAO,KAAK;;;oBAAK,qBAAM,gBAAI,CAAC,OAAO,CAAC;oBACtD,KAAK,EAAE,KAAK;iBACb,CAAC,EAAA;oBAFmC,sBAAA,SAEnC,EAAA;;;KAAA,CAAA;AAEF,IAAM,QAAQ,GAAG,UAAO,MAAc;;;;oBACvB,qBAAM,gBAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAA;;gBAAlC,IAAI,GAAG,SAA2B;gBAExC,IAAI,CAAC,IAAI,EAAE;oBACT,MAAM,uBAAU,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAA;iBAChD;gBAED,sBAAO,IAAI,EAAA;;;KACZ,CAAA;AAED,IAAM,WAAW,GAAG,UAAO,MAAc;IAAK,sBAAA,SAAG,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,EAAA;SAAA,CAAA;AAE7E,IAAM,WAAW,GAAG;IAClB,MAAM,QAAA;IACN,QAAQ,UAAA;IACR,WAAW,aAAA;IACX,WAAW,aAAA;IACX,cAAc,yBAAA;CACf,CAAA;AAGC,kCAAW","sourcesContent":["import { hash } from '@/lib/hash'\r\nimport { jwt } from '@/lib/jwt'\r\nimport { User } from '@/models/userModel'\r\nimport { IUser } from '@/types/IUser'\r\nimport { userErrors } from './userErrors'\r\nimport { customAlphabet } from 'nanoid'\r\n\r\nconst create = async (data: IUser) => {\r\n  const passHash = hash.encode(data.password)\r\n\r\n  const email = data?.email\r\n  if (await findByEmail(email)) {\r\n    throw userErrors.uniqueEmailError(email)\r\n  }\r\n\r\n  const user = await User.create({\r\n    ...data,\r\n    password: passHash\r\n  })\r\n\r\n  const userDb = user.toObject()\r\n\r\n  return userDb\r\n}\r\n\r\nconst findByEmail = async (email) => await User.findOne({\r\n  email: email\r\n})\r\n\r\nconst findById = async (userId: string) => {\r\n  const user = await User.findById(userId)\r\n\r\n  if (!user) {\r\n    throw userErrors.buildUserNotFoundError(userId)\r\n  }\r\n\r\n  return user\r\n}\r\n\r\nconst createToken = async (userId: string) => jwt.create({ user_id: userId })\r\n\r\nconst userService = {\r\n  create,\r\n  findById,\r\n  createToken,\r\n  findByEmail,\r\n  customAlphabet\r\n}\r\n\r\nexport {\r\n  userService\r\n}\r\n"]}]}