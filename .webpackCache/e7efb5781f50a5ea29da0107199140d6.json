{"remainingRequest":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js!C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\apps\\appService.ts","dependencies":[{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\apps\\appService.ts","mtime":1704481060442},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KdmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9DQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQ0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgfSk7DQp9Ow0KdmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHsNCiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnOw0KICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCAidGhyb3ciOiB2ZXJiKDEpLCAicmV0dXJuIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnOw0KICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfQ0KICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHsNCiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsNCiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHsNCiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbInJldHVybiJdIDogb3BbMF0gPyB5WyJ0aHJvdyJdIHx8ICgodCA9IHlbInJldHVybiJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDsNCiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTsNCiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9Ow0KICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsNCiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pOw0KICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9DQogICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9Ow0KICAgIH0NCn07DQp2YXIgX19yZXN0ID0gKHRoaXMgJiYgdGhpcy5fX3Jlc3QpIHx8IGZ1bmN0aW9uIChzLCBlKSB7DQogICAgdmFyIHQgPSB7fTsNCiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMCkNCiAgICAgICAgdFtwXSA9IHNbcF07DQogICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gImZ1bmN0aW9uIikNCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKQ0KICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dOw0KICAgICAgICB9DQogICAgcmV0dXJuIHQ7DQp9Ow0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCmV4cG9ydHMuYXBwU2VydmljZSA9IHZvaWQgMDsNCnZhciBlcnJvcl8xID0gcmVxdWlyZSgiQC9saWIvZXJyb3IiKTsNCnZhciBhcHBNb2RlbF8xID0gcmVxdWlyZSgiQC9tb2RlbHMvYXBwTW9kZWwiKTsNCnZhciBsb2dTZXJ2aWNlXzEgPSByZXF1aXJlKCIuLi9sb2cvbG9nU2VydmljZSIpOw0KdmFyIGFwcEVycm9yc18xID0gcmVxdWlyZSgiLi9hcHBFcnJvcnMiKTsNCnZhciBjcmVhdGUgPSBmdW5jdGlvbiAoZGF0YSwgdXNlcikgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgYXBwOw0KICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgew0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhLnJhdGluZzsNCiAgICAgICAgICAgICAgICBkZWxldGUgZGF0YS50b3RhbFJhdGluZzsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBhcHBNb2RlbF8xLkFwcC5jcmVhdGUoZGF0YSldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIGFwcCA9IF9hLnNlbnQoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBsb2dTZXJ2aWNlXzEubG9nU2VydmljZS5jcmVhdGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogdXNlci5faWQsDQogICAgICAgICAgICAgICAgICAgICAgICBldmVudDogJ0NyaWFyIGFwcCcsDQogICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWw6ICJBcHAgY29tIGlkICIuY29uY2F0KGFwcC5faWQsICIgY3JpYWRvIGNvbSBzdWNlc3NvISIpDQogICAgICAgICAgICAgICAgICAgIH0pXTsNCiAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICBfYS5zZW50KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGFwcF07DQogICAgICAgIH0NCiAgICB9KTsNCn0pOyB9Ow0KdmFyIGZpbmRCeUlkID0gZnVuY3Rpb24gKGFwcElkLCB1c2VyKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBhcHA7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgew0KICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGFwcE1vZGVsXzEuQXBwLmZpbmRCeUlkKGFwcElkKV07DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgYXBwID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIGlmICghYXBwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IGFwcEVycm9yc18xLmFwcEVycm9ycy5idWlsZEFwcE5vdEZvdW5kRXJyb3IoYXBwSWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBsb2dTZXJ2aWNlXzEubG9nU2VydmljZS5jcmVhdGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogdXNlci5faWQsDQogICAgICAgICAgICAgICAgICAgICAgICBldmVudDogJ09idGVyIGFwcCcsDQogICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWw6ICJBcHAgb2J0aWRvIGNvbSBvIGlkICIuY29uY2F0KGFwcElkKQ0KICAgICAgICAgICAgICAgICAgICB9KV07DQogICAgICAgICAgICBjYXNlIDI6DQogICAgICAgICAgICAgICAgX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBhcHBdOw0KICAgICAgICB9DQogICAgfSk7DQp9KTsgfTsNCnZhciB1cGRhdGUgPSBmdW5jdGlvbiAoX2EsIHVzZXIpIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7DQogICAgdmFyIHVwZGF0ZWRBcHA7DQogICAgdmFyIF9pZCA9IF9hLl9pZCwgYm9keSA9IF9fcmVzdChfYSwgWyJfaWQiXSk7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikgew0KICAgICAgICBzd2l0Y2ggKF9iLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgICAgaWYgKCFfaWQpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3JfMS5lcnJvci5idWlsZFNjaGVtYVZhbGlkYXRpb25FcnJvcih7DQogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnSUQgZG8gYXBwIG7Do28gZm9pIGluZm9ybWFkbyEnDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBkZWxldGUgYm9keS50b3RhbFJhdGluZzsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBhcHBNb2RlbF8xLkFwcC5maW5kQnlJZEFuZFVwZGF0ZShfaWQsIGJvZHksIHsgbmV3OiB0cnVlIH0pXTsNCiAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICB1cGRhdGVkQXBwID0gX2Iuc2VudCgpOw0KICAgICAgICAgICAgICAgIGlmICghdXBkYXRlZEFwcCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBhcHBFcnJvcnNfMS5hcHBFcnJvcnMuYnVpbGRBcHBOb3RGb3VuZEVycm9yKF9pZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGxvZ1NlcnZpY2VfMS5sb2dTZXJ2aWNlLmNyZWF0ZSh7DQogICAgICAgICAgICAgICAgICAgICAgICB1c2VyOiB1c2VyLl9pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnQWx0ZXJhciBhcHAnLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiAiQXBwIGNvbSBpZCAiLmNvbmNhdChfaWQsICIgYWx0ZXJhZG8gY29tIHN1Y2Vzc28hIikNCiAgICAgICAgICAgICAgICAgICAgfSldOw0KICAgICAgICAgICAgY2FzZSAyOg0KICAgICAgICAgICAgICAgIF9iLnNlbnQoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdXBkYXRlZEFwcF07DQogICAgICAgIH0NCiAgICB9KTsNCn0pOyB9Ow0KdmFyIGxpc3QgPSBmdW5jdGlvbiAoX2EsIHVzZXIpIHsNCiAgICB2YXIgc2VhcmNoID0gX2Euc2VhcmNoLCBfYiA9IF9hLnBhZ2UsIHBhZ2UgPSBfYiA9PT0gdm9pZCAwID8gMSA6IF9iLCBfYyA9IF9hLnBlclBhZ2UsIHBlclBhZ2UgPSBfYyA9PT0gdm9pZCAwID8gNTAgOiBfYzsNCiAgICByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIG1heFBhZ2VzLCBza2lwLCBmaWx0ZXIsIGFwcHMsIHRvdGFsU2l6ZTsNCiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfZCkgew0KICAgICAgICAgICAgc3dpdGNoIChfZC5sYWJlbCkgew0KICAgICAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICAgICAgbWF4UGFnZXMgPSBNYXRoLm1pbigrcGVyUGFnZSwgNTApOw0KICAgICAgICAgICAgICAgICAgICBza2lwID0gKCtwYWdlIC0gMSkgKiArcGVyUGFnZTsNCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbmV3IFJlZ0V4cChzZWFyY2gsICdpJykNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYXBwTW9kZWxfMS5BcHAuZmluZChmaWx0ZXIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNraXAoc2tpcCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubGltaXQobWF4UGFnZXMpXTsNCiAgICAgICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgICAgIGFwcHMgPSBfZC5zZW50KCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGFwcE1vZGVsXzEuQXBwLmNvdW50RG9jdW1lbnRzKGZpbHRlcildOw0KICAgICAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICAgICAgdG90YWxTaXplID0gX2Quc2VudCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBsb2dTZXJ2aWNlXzEubG9nU2VydmljZS5jcmVhdGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IHVzZXIuX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnTGlzdGFyIGFwcHMnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbDogJ0ZvaSBsaXN0YWRvIG9zIGFwcHMhJw0KICAgICAgICAgICAgICAgICAgICAgICAgfSldOw0KICAgICAgICAgICAgICAgIGNhc2UgMzoNCiAgICAgICAgICAgICAgICAgICAgX2Quc2VudCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgeyBhcHBzOiBhcHBzLCB0b3RhbFNpemU6IHRvdGFsU2l6ZSB9XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSk7DQp9Ow0KdmFyIHJlbW92ZSA9IGZ1bmN0aW9uIChhcHBJZCwgdXNlcikgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgYXBwLCByZW1vdmVkQXBwOw0KICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgew0KICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBhcHBNb2RlbF8xLkFwcC5maW5kQnlJZChhcHBJZCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIGFwcCA9IF9hLnNlbnQoKTsNCiAgICAgICAgICAgICAgICBpZiAoIWFwcCkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBhcHBFcnJvcnNfMS5hcHBFcnJvcnMuYnVpbGRBcHBOb3RGb3VuZEVycm9yKGFwcElkKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYXBwTW9kZWxfMS5BcHAuZmluZEJ5SWRBbmRSZW1vdmUoYXBwSWQpXTsNCiAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICByZW1vdmVkQXBwID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGxvZ1NlcnZpY2VfMS5sb2dTZXJ2aWNlLmNyZWF0ZSh7DQogICAgICAgICAgICAgICAgICAgICAgICB1c2VyOiB1c2VyLl9pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnUmVtb3ZlciBhcHAnLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiAiTyBhcHAgY29tIGlkICIuY29uY2F0KGFwcElkLCAiIGZvaSByZW1vdmlkbyBjb20gc3VjZXNzbyEiKQ0KICAgICAgICAgICAgICAgICAgICB9KV07DQogICAgICAgICAgICBjYXNlIDM6DQogICAgICAgICAgICAgICAgX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCByZW1vdmVkQXBwXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQp2YXIgYXBwU2VydmljZSA9IHsNCiAgICBjcmVhdGU6IGNyZWF0ZSwNCiAgICBmaW5kQnlJZDogZmluZEJ5SWQsDQogICAgdXBkYXRlOiB1cGRhdGUsDQogICAgbGlzdDogbGlzdCwNCiAgICByZW1vdmU6IHJlbW92ZQ0KfTsNCmV4cG9ydHMuYXBwU2VydmljZSA9IGFwcFNlcnZpY2U7DQo="},{"version":3,"file":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\apps\\appService.ts","sourceRoot":"","sources":["C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\apps\\appService.ts"],"names":[],"mappings":"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","sourcesContent":["import { error } from '@/lib/error'\r\nimport { App } from '@/models/appModel'\r\nimport { IUser } from '@/types/IUser'\r\nimport { IApp } from '@/types/IApp'\r\nimport { logService } from '../log/logService'\r\nimport { appErrors } from './appErrors'\r\n\r\nconst create = async (data: IApp, user: IUser) => {\r\n  delete data.rating\r\n  delete data.totalRating\r\n\r\n  const app = await App.create(data)\r\n\r\n  await logService.create({\r\n    user: user._id,\r\n    event: 'Criar app',\r\n    detail: `App com id ${app._id} criado com sucesso!`\r\n  })\r\n\r\n  return app\r\n}\r\n\r\nconst findById = async (appId: string, user: IUser) => {\r\n  const app = await App.findById(appId)\r\n\r\n  if (!app) {\r\n    throw appErrors.buildAppNotFoundError(appId)\r\n  }\r\n\r\n  await logService.create({\r\n    user: user._id,\r\n    event: 'Obter app',\r\n    detail: `App obtido com o id ${appId}`\r\n  })\r\n\r\n  return app\r\n}\r\n\r\nconst update = async ({ _id, ...body }, user: IUser) => {\r\n  if (!_id) {\r\n    throw error.buildSchemaValidationError({\r\n      message: 'ID do app nÃ£o foi informado!'\r\n    })\r\n  }\r\n\r\n  delete body.totalRating\r\n\r\n  const updatedApp = await App.findByIdAndUpdate(_id, body, { new: true })\r\n\r\n  if (!updatedApp) {\r\n    throw appErrors.buildAppNotFoundError(_id)\r\n  }\r\n\r\n  await logService.create({\r\n    user: user._id,\r\n    event: 'Alterar app',\r\n    detail: `App com id ${_id} alterado com sucesso!`\r\n  })\r\n\r\n  return updatedApp\r\n}\r\n\r\nconst list = async ({ search, page = 1, perPage = 50 }, user) => {\r\n  const maxPages = Math.min(+perPage, 50)\r\n  const skip = (+page - 1) * +perPage\r\n  const filter = {\r\n    name: new RegExp(search, 'i')\r\n  }\r\n\r\n  const apps = await App.find(filter)\r\n    .skip(skip)\r\n    .limit(maxPages)\r\n\r\n  const totalSize = await App.countDocuments(filter)\r\n\r\n  await logService.create({\r\n    user: user._id,\r\n    event: 'Listar apps',\r\n    detail: 'Foi listado os apps!'\r\n  })\r\n\r\n  return { apps, totalSize }\r\n}\r\n\r\nconst remove = async (appId: string, user: IUser) => {\r\n  const app = await App.findById(appId)\r\n\r\n  if (!app) {\r\n    throw appErrors.buildAppNotFoundError(appId)\r\n  }\r\n\r\n  const removedApp = await App.findByIdAndRemove(appId)\r\n\r\n  await logService.create({\r\n    user: user._id,\r\n    event: 'Remover app',\r\n    detail: `O app com id ${appId} foi removido com sucesso!`\r\n  })\r\n\r\n  return removedApp\r\n}\r\n\r\nconst appService = {\r\n  create,\r\n  findById,\r\n  update,\r\n  list,\r\n  remove\r\n}\r\n\r\nexport {\r\n  appService\r\n}\r\n"]}]}