{"remainingRequest":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js!C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\auth\\authService.ts","dependencies":[{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\auth\\authService.ts","mtime":1704481060446},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KdmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9DQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQ0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgfSk7DQp9Ow0KdmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHsNCiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnOw0KICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCAidGhyb3ciOiB2ZXJiKDEpLCAicmV0dXJuIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnOw0KICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfQ0KICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHsNCiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsNCiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHsNCiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbInJldHVybiJdIDogb3BbMF0gPyB5WyJ0aHJvdyJdIHx8ICgodCA9IHlbInJldHVybiJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDsNCiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTsNCiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9Ow0KICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsNCiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pOw0KICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9DQogICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9Ow0KICAgIH0NCn07DQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOw0KZXhwb3J0cy5hdXRoU2VydmljZSA9IHZvaWQgMDsNCnZhciBhdXRoRXJyb3JzXzEgPSByZXF1aXJlKCIuL2F1dGhFcnJvcnMiKTsNCnZhciBoYXNoXzEgPSByZXF1aXJlKCJAL2xpYi9oYXNoIik7DQp2YXIgand0XzEgPSByZXF1aXJlKCJAL2xpYi9qd3QiKTsNCnZhciB1c2VyTW9kZWxfMSA9IHJlcXVpcmUoIkAvbW9kZWxzL3VzZXJNb2RlbCIpOw0KdmFyIGxvZ1NlcnZpY2VfMSA9IHJlcXVpcmUoIi4uL2xvZy9sb2dTZXJ2aWNlIik7DQp2YXIgY3JlYXRlVG9rZW4gPSBmdW5jdGlvbiAodXNlcklkKSB7IHJldHVybiBqd3RfMS5qd3QuY3JlYXRlKHsNCiAgICB1c2VyX2lkOiB1c2VySWQNCn0pOyB9Ow0KdmFyIGF1dGhlbnRpY2F0ZVVzZXIgPSBmdW5jdGlvbiAodXNlcklkKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciB0b2tlbiwgdXNlclRvQXV0aDsNCiAgICB2YXIgX2E7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikgew0KICAgICAgICBzd2l0Y2ggKF9iLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgICAgdG9rZW4gPSBjcmVhdGVUb2tlbih1c2VySWQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHVzZXJNb2RlbF8xLlVzZXIuZmluZEJ5SWQodXNlcklkKS5zZWxlY3QoJy1wYXNzd29yZCcpXTsNCiAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICB1c2VyVG9BdXRoID0gKF9hID0gKF9iLnNlbnQoKSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b09iamVjdCh7IHZpcnR1YWxzOiB0cnVlIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB7DQogICAgICAgICAgICAgICAgICAgICAgICB1c2VyOiB1c2VyVG9BdXRoLA0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW46IHRva2VuDQogICAgICAgICAgICAgICAgICAgIH1dOw0KICAgICAgICB9DQogICAgfSk7DQp9KTsgfTsNCnZhciBhdXRoID0gZnVuY3Rpb24gKF9hKSB7DQogICAgdmFyIGVtYWlsID0gX2EuZW1haWwsIHBhc3N3b3JkID0gX2EucGFzc3dvcmQ7DQogICAgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBwYXNzSGFzaCwgdXNlclRvQXV0aCwgX2IsIHVzZXIsIHRva2VuOw0KICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9jKSB7DQogICAgICAgICAgICBzd2l0Y2ggKF9jLmxhYmVsKSB7DQogICAgICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgICAgICBwYXNzSGFzaCA9IGhhc2hfMS5oYXNoLmVuY29kZShwYXNzd29yZCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHVzZXJNb2RlbF8xLlVzZXIuZmluZE9uZSh7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3NIYXNoLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbA0KICAgICAgICAgICAgICAgICAgICAgICAgfSldOw0KICAgICAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICAgICAgdXNlclRvQXV0aCA9IF9jLnNlbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyVG9BdXRoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBhdXRoRXJyb3JzXzEuYXV0aEVycm9ycy5sb2dpbkVycm9yKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYXV0aGVudGljYXRlVXNlcih1c2VyVG9BdXRoLl9pZCldOw0KICAgICAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICAgICAgX2IgPSBfYy5zZW50KCksIHVzZXIgPSBfYi51c2VyLCB0b2tlbiA9IF9iLnRva2VuOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBsb2dTZXJ2aWNlXzEubG9nU2VydmljZS5jcmVhdGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IHVzZXJUb0F1dGguX2lkLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiAnVXNlciByZWFsaXpvdSBsb2dpbicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiAiVXN1XHUwMEUxcmlvIGNvbSBpZCAiLmNvbmNhdCh1c2VyVG9BdXRoLl9pZCwgIiByZWFsaXpvdSBsb2dpbiIpDQogICAgICAgICAgICAgICAgICAgICAgICB9KV07DQogICAgICAgICAgICAgICAgY2FzZSAzOg0KICAgICAgICAgICAgICAgICAgICBfYy5zZW50KCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogdXNlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogdG9rZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIH1dOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9KTsNCn07DQp2YXIgYXV0aFNlcnZpY2UgPSB7DQogICAgYXV0aGVudGljYXRlVXNlcjogYXV0aGVudGljYXRlVXNlciwNCiAgICBjcmVhdGVUb2tlbjogY3JlYXRlVG9rZW4sDQogICAgYXV0aDogYXV0aA0KfTsNCmV4cG9ydHMuYXV0aFNlcnZpY2UgPSBhdXRoU2VydmljZTsNCg=="},{"version":3,"file":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\auth\\authService.ts","sourceRoot":"","sources":["C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\auth\\authService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,2CAAyC;AACzC,mCAAiC;AACjC,iCAA+B;AAC/B,gDAAyC;AACzC,gDAA8C;AAE9C,IAAM,WAAW,GAAG,UAAC,MAAc,IAAK,OAAA,SAAG,CAAC,MAAM,CAAC;IACjD,OAAO,EAAE,MAAM;CAChB,CAAC,EAFsC,CAEtC,CAAA;AAEF,IAAM,gBAAgB,GAAG,UAAO,MAAM;;;;;;gBAC9B,KAAK,GAAG,WAAW,CAAC,MAAM,CAAC,CAAA;gBAEb,qBAAM,gBAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,WAAW,CAAC,EAAA;;gBAA7D,UAAU,GAAG,MAAA,CAAC,SAA+C,CAAC,0CAAE,QAAQ,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;gBAElG,sBAAO;wBACL,IAAI,EAAE,UAAU;wBAChB,KAAK,OAAA;qBACN,EAAA;;;KACF,CAAA;AAED,IAAM,IAAI,GAAG,UAAO,EAAmB;QAAjB,KAAK,WAAA,EAAE,QAAQ,cAAA;;;;;;oBAC7B,QAAQ,GAAG,WAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAA;oBAEnB,qBAAM,gBAAI,CAAC,OAAO,CAAC;4BACpC,QAAQ,EAAE,QAAQ;4BAClB,KAAK,OAAA;yBACN,CAAC,EAAA;;oBAHI,UAAU,GAAG,SAGjB;oBAEF,IAAI,CAAC,UAAU,EAAE;wBACf,MAAM,uBAAU,CAAC,UAAU,EAAE,CAAA;qBAC9B;oBAEuB,qBAAM,gBAAgB,CAAC,UAAU,CAAC,GAAG,CAAC,EAAA;;oBAAxD,KAAkB,SAAsC,EAAtD,IAAI,UAAA,EAAE,KAAK,WAAA;oBAEnB,qBAAM,uBAAU,CAAC,MAAM,CAAC;4BACtB,IAAI,EAAE,UAAU,CAAC,GAAG;4BACpB,KAAK,EAAE,qBAAqB;4BAC5B,MAAM,EAAE,8BAAkB,UAAU,CAAC,GAAG,oBAAiB;yBAC1D,CAAC,EAAA;;oBAJF,SAIE,CAAA;oBAEF,sBAAO;4BACL,IAAI,MAAA;4BACJ,KAAK,OAAA;yBACN,EAAA;;;;CACF,CAAA;AAED,IAAM,WAAW,GAAG;IAClB,gBAAgB,kBAAA;IAChB,WAAW,aAAA;IACX,IAAI,MAAA;CACL,CAAA;AAGC,kCAAW","sourcesContent":["import { authErrors } from './authErrors'\r\nimport { hash } from '@/lib/hash'\r\nimport { jwt } from '@/lib/jwt'\r\nimport { User } from '@/models/userModel'\r\nimport { logService } from '../log/logService'\r\n\r\nconst createToken = (userId: string) => jwt.create({\r\n  user_id: userId\r\n})\r\n\r\nconst authenticateUser = async (userId) => {\r\n  const token = createToken(userId)\r\n\r\n  const userToAuth = (await User.findById(userId).select('-password'))?.toObject({ virtuals: true })\r\n\r\n  return {\r\n    user: userToAuth,\r\n    token\r\n  }\r\n}\r\n\r\nconst auth = async ({ email, password }) => {\r\n  const passHash = hash.encode(password)\r\n\r\n  const userToAuth = await User.findOne({\r\n    password: passHash,\r\n    email\r\n  })\r\n\r\n  if (!userToAuth) {\r\n    throw authErrors.loginError()\r\n  }\r\n\r\n  const { user, token } = await authenticateUser(userToAuth._id)\r\n\r\n  await logService.create({\r\n    user: userToAuth._id,\r\n    event: 'User realizou login',\r\n    detail: `Usuário com id ${userToAuth._id} realizou login`\r\n  })\r\n\r\n  return {\r\n    user,\r\n    token\r\n  }\r\n}\r\n\r\nconst authService = {\r\n  authenticateUser,\r\n  createToken,\r\n  auth\r\n}\r\n\r\nexport {\r\n  authService\r\n}\r\n"]}]}