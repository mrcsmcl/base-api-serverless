{"remainingRequest":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js!C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\database.ts","dependencies":[{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\database.ts","mtime":1704481060432},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KdmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgew0KICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7DQogICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykgew0KICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsNCiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkNCiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdDsNCiAgICB9Ow0KICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOw0KfTsNCnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfQ0KICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH0NCiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgIH0pOw0KfTsNCnZhciBfX2dlbmVyYXRvciA9ICh0aGlzICYmIHRoaXMuX19nZW5lcmF0b3IpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBib2R5KSB7DQogICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZzsNCiAgICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgInRocm93IjogdmVyYigxKSwgInJldHVybiI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZzsNCiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH0NCiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7DQogICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuIik7DQogICAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7DQogICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5WyJyZXR1cm4iXSA6IG9wWzBdID8geVsidGhyb3ciXSB8fCAoKHQgPSB5WyJyZXR1cm4iXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7DQogICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07DQogICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7DQogICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTsNCiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7DQogICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7DQogICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfQ0KICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsNCiAgICB9DQp9Ow0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCmV4cG9ydHMuZGlzY29ubmVjdFdpdGggPSBleHBvcnRzLmRpc2Nvbm5lY3QgPSBleHBvcnRzLmNvbm5lY3QgPSB2b2lkIDA7DQp2YXIgY29uZmlnXzEgPSByZXF1aXJlKCJAL2NvbmZpZyIpOw0KdmFyIG1vbmdvb3NlID0gcmVxdWlyZSgibW9uZ29vc2UiKTsNCnZhciBjb25uID0gbnVsbDsNCnZhciBjb25uZWN0ID0gZnVuY3Rpb24gKGNvbm5lY3RPcHRpb25zKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBtb25nb0NvbmZpZzsNCiAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICBtb25nb0NvbmZpZyA9IF9fYXNzaWduKHsgaWdub3JlVW5kZWZpbmVkOiB0cnVlLCBhdXRvSW5kZXg6IGZhbHNlLCBhdXRvQ3JlYXRlOiBmYWxzZSwgbWF4UG9vbFNpemU6IDEgfSwgY29ubmVjdE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG1vbmdvb3NlLnNldCgnc3RyaWN0UXVlcnknLCB0cnVlKV07DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIGlmICghKCFjb25maWdfMS5jb25maWcuSVNfVEVTVCAmJiAhY29ubikpIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdOw0KICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG1vbmdvb3NlLmNvbm5lY3QoY29uZmlnXzEuY29uZmlnLkRBVEFCQVNFX1VSTCwgbW9uZ29Db25maWcpXTsNCiAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICBjb25uID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMzsNCiAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGNvbm5dOw0KICAgICAgICB9DQogICAgfSk7DQp9KTsgfTsNCmV4cG9ydHMuY29ubmVjdCA9IGNvbm5lY3Q7DQp2YXIgZGlzY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgew0KICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgICAgaWYgKCEoIWNvbmZpZ18xLmNvbmZpZy5JU19MT0NBTCAmJiAhY29uZmlnXzEuY29uZmlnLklTX1RFU1QpKSByZXR1cm4gWzMgLypicmVhayovLCAyXTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBtb25nb29zZS5kaXNjb25uZWN0KCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIF9hLnNlbnQoKTsNCiAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDI7DQogICAgICAgICAgICBjYXNlIDI6IHJldHVybiBbMiAvKnJldHVybiovXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQpleHBvcnRzLmRpc2Nvbm5lY3QgPSBkaXNjb25uZWN0Ow0KdmFyIGRpc2Nvbm5lY3RXaXRoID0gZnVuY3Rpb24gKGNvbm5lY3QpIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgew0KICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgICAgaWYgKCEoIWNvbmZpZ18xLmNvbmZpZy5JU19MT0NBTCAmJiAhY29uZmlnXzEuY29uZmlnLklTX1RFU1QpKSByZXR1cm4gWzMgLypicmVhayovLCAyXTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBjb25uZWN0LmNvbm5lY3Rpb24uY2xvc2UoKV07DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIGNvbm4gPSBudWxsOw0KICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjsNCiAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIFsyIC8qcmV0dXJuKi9dOw0KICAgICAgICB9DQogICAgfSk7DQp9KTsgfTsNCmV4cG9ydHMuZGlzY29ubmVjdFdpdGggPSBkaXNjb25uZWN0V2l0aDsNCg=="},{"version":3,"file":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\database.ts","sourceRoot":"","sources":["C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\database.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,mCAAiC;AACjC,mCAAoC;AAEpC,IAAI,IAAI,GAAQ,IAAI,CAAA;AAEpB,IAAM,OAAO,GAAG,UAAO,cAAwC;;;;;gBACvD,WAAW,cACf,eAAe,EAAE,IAAI,EACrB,SAAS,EAAE,KAAK,EAChB,UAAU,EAAE,KAAK,EACjB,WAAW,EAAE,CAAC,IACX,cAAc,CAClB,CAAA;gBAED,qBAAM,QAAQ,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,EAAA;;gBAAvC,SAAuC,CAAA;qBAEnC,CAAA,CAAC,eAAM,CAAC,OAAO,IAAI,CAAC,IAAI,CAAA,EAAxB,wBAAwB;gBACnB,qBAAM,QAAQ,CAAC,OAAO,CAAC,eAAM,CAAC,YAAY,EAAE,WAAW,CAAC,EAAA;;gBAA/D,IAAI,GAAG,SAAwD,CAAA;;oBAGjE,sBAAO,IAAI,EAAA;;;KACZ,CAAA;AAgBC,0BAAO;AAdT,IAAM,UAAU,GAAG;;;;qBACb,CAAA,CAAC,eAAM,CAAC,QAAQ,IAAI,CAAC,eAAM,CAAC,OAAO,CAAA,EAAnC,wBAAmC;gBACrC,qBAAM,QAAQ,CAAC,UAAU,EAAE,EAAA;;gBAA3B,SAA2B,CAAA;;;;;KAE9B,CAAA;AAWC,gCAAU;AATZ,IAAM,cAAc,GAAG,UAAO,OAAY;;;;qBACpC,CAAA,CAAC,eAAM,CAAC,QAAQ,IAAI,CAAC,eAAM,CAAC,OAAO,CAAA,EAAnC,wBAAmC;gBACrC,qBAAM,OAAO,CAAC,UAAU,CAAC,KAAK,EAAE,EAAA;;gBAAhC,SAAgC,CAAA;gBAChC,IAAI,GAAG,IAAI,CAAA;;;;;KAEd,CAAA;AAKC,wCAAc","sourcesContent":["\r\nimport { config } from '@/config'\r\nimport * as mongoose from 'mongoose'\r\n\r\nlet conn: any = null\r\n\r\nconst connect = async (connectOptions?: mongoose.ConnectOptions) => {\r\n  const mongoConfig: mongoose.ConnectOptions = {\r\n    ignoreUndefined: true,\r\n    autoIndex: false,\r\n    autoCreate: false,\r\n    maxPoolSize: 1,\r\n    ...connectOptions\r\n  }\r\n\r\n  await mongoose.set('strictQuery', true)\r\n\r\n  if (!config.IS_TEST && !conn) {\r\n    conn = await mongoose.connect(config.DATABASE_URL, mongoConfig)\r\n  }\r\n\r\n  return conn\r\n}\r\n\r\nconst disconnect = async () => {\r\n  if (!config.IS_LOCAL && !config.IS_TEST) {\r\n    await mongoose.disconnect()\r\n  }\r\n}\r\n\r\nconst disconnectWith = async (connect: any) => {\r\n  if (!config.IS_LOCAL && !config.IS_TEST) {\r\n    await connect.connection.close()\r\n    conn = null\r\n  }\r\n}\r\n\r\nexport {\r\n  connect,\r\n  disconnect,\r\n  disconnectWith\r\n}\r\n"]}]}