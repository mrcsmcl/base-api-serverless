{"remainingRequest":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js!C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\auth.ts","dependencies":[{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\auth.ts","mtime":1704481060432},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KdmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9DQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQ0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgfSk7DQp9Ow0KdmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHsNCiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnOw0KICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCAidGhyb3ciOiB2ZXJiKDEpLCAicmV0dXJuIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnOw0KICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfQ0KICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHsNCiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsNCiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHsNCiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbInJldHVybiJdIDogb3BbMF0gPyB5WyJ0aHJvdyJdIHx8ICgodCA9IHlbInJldHVybiJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDsNCiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTsNCiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9Ow0KICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsNCiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pOw0KICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9DQogICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9Ow0KICAgIH0NCn07DQp2YXIgX19yZWFkID0gKHRoaXMgJiYgdGhpcy5fX3JlYWQpIHx8IGZ1bmN0aW9uIChvLCBuKSB7DQogICAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9bU3ltYm9sLml0ZXJhdG9yXTsNCiAgICBpZiAoIW0pIHJldHVybiBvOw0KICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlOw0KICAgIHRyeSB7DQogICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpOw0KICAgIH0NCiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH0NCiAgICBmaW5hbGx5IHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpWyJyZXR1cm4iXSkpIG0uY2FsbChpKTsNCiAgICAgICAgfQ0KICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH0NCiAgICB9DQogICAgcmV0dXJuIGFyOw0KfTsNCnZhciBfX3NwcmVhZEFycmF5ID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5KSB8fCBmdW5jdGlvbiAodG8sIGZyb20sIHBhY2spIHsNCiAgICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykgew0KICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7DQogICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpOw0KICAgICAgICAgICAgYXJbaV0gPSBmcm9tW2ldOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpOw0KfTsNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7DQpleHBvcnRzLmF1dGggPSB2b2lkIDA7DQp2YXIgdXNlclNlcnZpY2VfMSA9IHJlcXVpcmUoIkAvaGFuZGxlcnMvdXNlci91c2VyU2VydmljZSIpOw0KdmFyIGVycm9yXzEgPSByZXF1aXJlKCIuL2Vycm9yIik7DQp2YXIgand0XzEgPSByZXF1aXJlKCIuL2p3dCIpOw0KdmFyIFRPS0VOX0hFQURFUl9LRVkgPSAneC1hcGkta2V5JzsNCnZhciBwYXJzZVVzZXJQYXlsb2FkID0gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgdmFyIHRva2VuID0gZXZlbnQuaGVhZGVyc1tUT0tFTl9IRUFERVJfS0VZXTsNCiAgICB2YXIgdXNlciA9IGp3dF8xLmp3dC52ZXJpZnkodG9rZW4pOw0KICAgIGlmICghdXNlcikgew0KICAgICAgICB0aHJvdyBlcnJvcl8xLmVycm9yLmJ1aWxkTm90QXV0aG9yaXplZEVycm9yKCk7DQogICAgfQ0KICAgIHJldHVybiB1c2VyOw0KfTsNCnZhciBhdXRoVXNlciA9IGZ1bmN0aW9uIChldmVudCkgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgcGF5bG9hZCwgdXNlcjsNCiAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICBwYXlsb2FkID0gcGFyc2VVc2VyUGF5bG9hZChldmVudCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdXNlclNlcnZpY2VfMS51c2VyU2VydmljZS5maW5kQnlJZChwYXlsb2FkLnVzZXJfaWQpXTsNCiAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICB1c2VyID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB1c2VyXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQp2YXIgYXV0aFRva2VuID0gZnVuY3Rpb24gKGV2ZW50KSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBwYXlsb2FkLCB1c2VyOw0KICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgew0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgIHBheWxvYWQgPSBwYXJzZVVzZXJQYXlsb2FkKGV2ZW50KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB1c2VyU2VydmljZV8xLnVzZXJTZXJ2aWNlLmZpbmRCeUlkKHBheWxvYWQudXNlcl9pZCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIHVzZXIgPSBfYS5zZW50KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHVzZXJdOw0KICAgICAgICB9DQogICAgfSk7DQp9KTsgfTsNCnZhciB2ZXJpZnlDb250ZXh0ID0gZnVuY3Rpb24gKGV2ZW50KSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciB1c2VyOw0KICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgew0KICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBhdXRoVXNlcihldmVudCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIHVzZXIgPSBfYS5zZW50KCk7DQogICAgICAgICAgICAgICAgZXZlbnQudXNlciA9IHVzZXI7DQogICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dOw0KICAgICAgICB9DQogICAgfSk7DQp9KTsgfTsNCnZhciB2ZXJpZnlMb2dnZWQgPSBmdW5jdGlvbiAoaGFuZGxlcikgeyByZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgdmFyIHJlc3QgPSBbXTsNCiAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgew0KICAgICAgICByZXN0W19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOw0KICAgIH0NCiAgICByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHVzZXI7DQogICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGF1dGhUb2tlbihldmVudCldOw0KICAgICAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IF9hLnNlbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgZXZlbnQudXNlciA9IHVzZXI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBoYW5kbGVyLmFwcGx5KHZvaWQgMCwgX19zcHJlYWRBcnJheShbZXZlbnRdLCBfX3JlYWQocmVzdCksIGZhbHNlKSldOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9KTsNCn07IH07DQp2YXIgYXV0aCA9IHsNCiAgICB2ZXJpZnlMb2dnZWQ6IHZlcmlmeUxvZ2dlZCwNCiAgICB2ZXJpZnlDb250ZXh0OiB2ZXJpZnlDb250ZXh0LA0KICAgIHBhcnNlVXNlclBheWxvYWQ6IHBhcnNlVXNlclBheWxvYWQsDQogICAgVE9LRU5fSEVBREVSX0tFWTogVE9LRU5fSEVBREVSX0tFWQ0KfTsNCmV4cG9ydHMuYXV0aCA9IGF1dGg7DQo="},{"version":3,"file":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\auth.ts","sourceRoot":"","sources":["C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\lib\\auth.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,2DAAyD;AACzD,iCAA+B;AAC/B,6BAA2B;AAE3B,IAAM,gBAAgB,GAAG,WAAW,CAAA;AAEpC,IAAM,gBAAgB,GAAG,UAAC,KAAK;IAC7B,IAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAA;IAC7C,IAAM,IAAI,GAAG,SAAG,CAAC,MAAM,CAAC,KAAK,CAAQ,CAAA;IACrC,IAAI,CAAC,IAAI,EAAE;QACT,MAAM,aAAK,CAAC,uBAAuB,EAAE,CAAA;KACtC;IAED,OAAO,IAAI,CAAA;AACb,CAAC,CAAA;AAED,IAAM,QAAQ,GAAG,UAAO,KAAK;;;;;gBACrB,OAAO,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAA;gBAC1B,qBAAM,yBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,EAAA;;gBAAlD,IAAI,GAAG,SAA2C;gBAExD,sBAAO,IAAI,EAAA;;;KACZ,CAAA;AAED,IAAM,SAAS,GAAG,UAAO,KAAK;;;;;gBACtB,OAAO,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAA;gBAC1B,qBAAM,yBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,EAAA;;gBAAlD,IAAI,GAAG,SAA2C;gBAExD,sBAAO,IAAI,EAAA;;;KACZ,CAAA;AAED,IAAM,aAAa,GAAG,UAAO,KAAK;;;;oBACnB,qBAAM,QAAQ,CAAC,KAAK,CAAC,EAAA;;gBAA5B,IAAI,GAAG,SAAqB;gBAClC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAA;;;;KAClB,CAAA;AAED,IAAM,YAAY,GAAG,UAAC,OAAO,IAAK,OAAA,UAAO,KAAK;IAAE,cAAO;SAAP,UAAO,EAAP,qBAAO,EAAP,IAAO;QAAP,6BAAO;;;;;;wBACxC,qBAAM,SAAS,CAAC,KAAK,CAAC,EAAA;;oBAA7B,IAAI,GAAG,SAAsB;oBACnC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAA;oBAEjB,sBAAO,OAAO,8BAAC,KAAK,UAAK,IAAI,YAAC;;;;CAC/B,EALiC,CAKjC,CAAA;AAED,IAAM,IAAI,GAAG;IACX,YAAY,cAAA;IACZ,aAAa,eAAA;IACb,gBAAgB,kBAAA;IAChB,gBAAgB,kBAAA;CACjB,CAAA;AAGC,oBAAI","sourcesContent":["import { userService } from '@/handlers/user/userService'\r\nimport { error } from './error'\r\nimport { jwt } from './jwt'\r\n\r\nconst TOKEN_HEADER_KEY = 'x-api-key'\r\n\r\nconst parseUserPayload = (event) => {\r\n  const token = event.headers[TOKEN_HEADER_KEY]\r\n  const user = jwt.verify(token) as any\r\n  if (!user) {\r\n    throw error.buildNotAuthorizedError()\r\n  }\r\n\r\n  return user\r\n}\r\n\r\nconst authUser = async (event) => {\r\n  const payload = parseUserPayload(event)\r\n  const user = await userService.findById(payload.user_id)\r\n\r\n  return user\r\n}\r\n\r\nconst authToken = async (event) => {\r\n  const payload = parseUserPayload(event)\r\n  const user = await userService.findById(payload.user_id)\r\n\r\n  return user\r\n}\r\n\r\nconst verifyContext = async (event) => {\r\n  const user = await authUser(event)\r\n  event.user = user\r\n}\r\n\r\nconst verifyLogged = (handler) => async (event, ...rest) => {\r\n  const user = await authToken(event)\r\n  event.user = user\r\n\r\n  return handler(event, ...rest)\r\n}\r\n\r\nconst auth = {\r\n  verifyLogged,\r\n  verifyContext,\r\n  parseUserPayload,\r\n  TOKEN_HEADER_KEY\r\n}\r\n\r\nexport {\r\n  auth\r\n}\r\n"]}]}