{"remainingRequest":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js!C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\aulas\\aulaService.ts","dependencies":[{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\aulas\\aulaService.ts","mtime":1704662452966},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KdmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9DQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQ0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgfSk7DQp9Ow0KdmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHsNCiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnOw0KICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCAidGhyb3ciOiB2ZXJiKDEpLCAicmV0dXJuIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnOw0KICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfQ0KICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHsNCiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsNCiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHsNCiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbInJldHVybiJdIDogb3BbMF0gPyB5WyJ0aHJvdyJdIHx8ICgodCA9IHlbInJldHVybiJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDsNCiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTsNCiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9Ow0KICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsNCiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pOw0KICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9DQogICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9Ow0KICAgIH0NCn07DQp2YXIgX19yZXN0ID0gKHRoaXMgJiYgdGhpcy5fX3Jlc3QpIHx8IGZ1bmN0aW9uIChzLCBlKSB7DQogICAgdmFyIHQgPSB7fTsNCiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMCkNCiAgICAgICAgdFtwXSA9IHNbcF07DQogICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gImZ1bmN0aW9uIikNCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKQ0KICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dOw0KICAgICAgICB9DQogICAgcmV0dXJuIHQ7DQp9Ow0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCmV4cG9ydHMuc2F2ZVByb2dyZXNzID0gZXhwb3J0cy51cGRhdGVBdWxhID0gZXhwb3J0cy5saXN0QXVsYXMgPSBleHBvcnRzLmdldEF1bGEgPSBleHBvcnRzLmRlbGV0ZUF1bGEgPSBleHBvcnRzLmNyZWF0ZUF1bGEgPSBleHBvcnRzLm1haW4gPSB2b2lkIDA7DQp2YXIgc2F2ZVByb2dyZXNzXzEgPSByZXF1aXJlKCIuL3NhdmVQcm9ncmVzcyIpOw0KdmFyIGF1dGhfMSA9IHJlcXVpcmUoIkAvbGliL2F1dGgiKTsNCnZhciByb3V0ZXJfMSA9IHJlcXVpcmUoIkAvbGliL3JvdXRlciIpOw0KdmFyIGNyZWF0ZUF1bGFfMSA9IHJlcXVpcmUoIi4vY3JlYXRlQXVsYSIpOw0KdmFyIGRlbGV0ZUF1bGFfMSA9IHJlcXVpcmUoIi4vZGVsZXRlQXVsYSIpOw0KdmFyIGdldEF1bGFfMSA9IHJlcXVpcmUoIi4vZ2V0QXVsYSIpOw0KdmFyIGxpc3RBdWxhc18xID0gcmVxdWlyZSgiLi9saXN0QXVsYXMiKTsNCnZhciB1cGRhdGVBdWxhXzEgPSByZXF1aXJlKCIuL3VwZGF0ZUF1bGEiKTsNCnZhciBhdWxhTW9kZWxfMSA9IHJlcXVpcmUoIkAvbW9kZWxzL2F1bGFNb2RlbCIpOw0KdmFyIHJvdXRlciA9ICgwLCByb3V0ZXJfMS5idWlsZFJvdXRlcikoKTsNCnJvdXRlci5wb3N0KCcvYXVsYXMnLCBhdXRoXzEuYXV0aC52ZXJpZnlMb2dnZWQoY3JlYXRlQXVsYV8xLmNyZWF0ZUF1bGFIYW5kbGVyKSk7DQpyb3V0ZXIuZ2V0KCcvYXVsYXMve2F1bGFJZH0nLCBhdXRoXzEuYXV0aC52ZXJpZnlMb2dnZWQoZ2V0QXVsYV8xLmdldEF1bGFIYW5kbGVyKSk7DQpyb3V0ZXIucHV0KCcvYXVsYXMnLCBhdXRoXzEuYXV0aC52ZXJpZnlMb2dnZWQodXBkYXRlQXVsYV8xLnVwZGF0ZUF1bGFIYW5kbGVyKSk7DQpyb3V0ZXIuZ2V0KCcvYXVsYXMnLCBhdXRoXzEuYXV0aC52ZXJpZnlMb2dnZWQobGlzdEF1bGFzXzEubGlzdEF1bGFzSGFuZGxlcikpOw0Kcm91dGVyLmRlbGV0ZSgnL2F1bGFzL3thdWxhSWR9JywgYXV0aF8xLmF1dGgudmVyaWZ5TG9nZ2VkKGRlbGV0ZUF1bGFfMS5kZWxldGVBdWxhSGFuZGxlcikpOw0Kcm91dGVyLnBvc3QoJy9hdWxhcy97YXVsYUlkfS9taW5lJywgYXV0aF8xLmF1dGgudmVyaWZ5TG9nZ2VkKHNhdmVQcm9ncmVzc18xLnNhdmVQcm9ncmVzc0hhbmRsZXIpKTsNCnZhciBtYWluID0gKDAsIHJvdXRlcl8xLmJ1aWxkSGFuZGxlcikocm91dGVyKTsNCmV4cG9ydHMubWFpbiA9IG1haW47DQp2YXIgY3JlYXRlQXVsYSA9IGZ1bmN0aW9uIChkYXRhKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBub3ZhQXVsYTsNCiAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgYXVsYU1vZGVsXzEuQXVsYS5jcmVhdGUoZGF0YSldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIG5vdmFBdWxhID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBub3ZhQXVsYV07DQogICAgICAgIH0NCiAgICB9KTsNCn0pOyB9Ow0KZXhwb3J0cy5jcmVhdGVBdWxhID0gY3JlYXRlQXVsYTsNCnZhciBkZWxldGVBdWxhID0gZnVuY3Rpb24gKGF1bGFJZCkgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgYXVsYUV4Y2x1aWRhOw0KICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgew0KICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBhdWxhTW9kZWxfMS5BdWxhLmZpbmRCeUlkQW5kRGVsZXRlKGF1bGFJZCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIGF1bGFFeGNsdWlkYSA9IF9hLnNlbnQoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgYXVsYUV4Y2x1aWRhXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQpleHBvcnRzLmRlbGV0ZUF1bGEgPSBkZWxldGVBdWxhOw0KdmFyIGdldEF1bGEgPSBmdW5jdGlvbiAoYXVsYUlkKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBhdWxhOw0KICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgew0KICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBhdWxhTW9kZWxfMS5BdWxhLmZpbmRCeUlkKGF1bGFJZCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIGF1bGEgPSBfYS5zZW50KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGF1bGFdOw0KICAgICAgICB9DQogICAgfSk7DQp9KTsgfTsNCmV4cG9ydHMuZ2V0QXVsYSA9IGdldEF1bGE7DQp2YXIgbGlzdEF1bGFzID0gZnVuY3Rpb24gKGZpbHRybykgew0KICAgIGlmIChmaWx0cm8gPT09IHZvaWQgMCkgeyBmaWx0cm8gPSB7fTsgfQ0KICAgIHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgcXVlcnksIGF1bGFzOw0KICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7DQogICAgICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IHt9Ow0KICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdHJvLnRpdHVsbykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkudGl0dWxvID0geyAkcmVnZXg6IGZpbHRyby50aXR1bG8sICRvcHRpb25zOiAnaScgfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdHJvLmRlc2NyaWNhbykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkuZGVzY3JpY2FvID0geyAkcmVnZXg6IGZpbHRyby5kZXNjcmljYW8sICRvcHRpb25zOiAnaScgfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdHJvLnRlbVZpZGVvICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5LnVybFZpZGVvID0geyAkZXhpc3RzOiBmaWx0cm8udGVtVmlkZW8gfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAvLyBBZGljaW9uZSBjb25kacOnw7VlcyBwYXJhIGZpbHRyYXIgcG9yIGNvbmNsdXPDo28sIHByb2dyZXNzbyBtw61uaW1vIGUgcGVyZm9ybWFuY2UgbcOheGltYQ0KICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdHJvLmNvbmNsdWlkbyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVsncHJvZ3Jlc3NQb3JVc3VhcmlvLnByb2dyZXNzJ10gPSBmaWx0cm8uY29uY2x1aWRvID8gMTAwIDogeyAkbHQ6IDEwMCB9Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChmaWx0cm8ucHJvZ3Jlc3NvTWluICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5Wydwcm9ncmVzc1BvclVzdWFyaW8ucHJvZ3Jlc3MnXSA9IHsgJGd0ZTogZmlsdHJvLnByb2dyZXNzb01pbiB9Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChmaWx0cm8ucGVyZm9ybWFuY2VNYXggIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlbJ3Byb2dyZXNzUG9yVXN1YXJpby5wZXJmb3JtYW5jZSddID0geyAkbHRlOiBmaWx0cm8ucGVyZm9ybWFuY2VNYXggfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBhdWxhTW9kZWxfMS5BdWxhLmZpbmQocXVlcnkpXTsNCiAgICAgICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgICAgIGF1bGFzID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgYXVsYXNdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9KTsNCn07DQpleHBvcnRzLmxpc3RBdWxhcyA9IGxpc3RBdWxhczsNCnZhciB1cGRhdGVBdWxhID0gZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7DQogICAgdmFyIGF1bGFJZCwgYXR1YWxpemFjb2VzLCBhdWxhQXR1YWxpemFkYTsNCiAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICBhdWxhSWQgPSBkYXRhLmF1bGFJZCwgYXR1YWxpemFjb2VzID0gX19yZXN0KGRhdGEsIFsiYXVsYUlkIl0pOw0KICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGF1bGFNb2RlbF8xLkF1bGEuZmluZEJ5SWRBbmRVcGRhdGUoYXVsYUlkLCB7ICRzZXQ6IGF0dWFsaXphY29lcyB9LCB7IG5ldzogdHJ1ZSB9KV07DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgYXVsYUF0dWFsaXphZGEgPSBfYS5zZW50KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGF1bGFBdHVhbGl6YWRhXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQpleHBvcnRzLnVwZGF0ZUF1bGEgPSB1cGRhdGVBdWxhOw0KdmFyIHNhdmVQcm9ncmVzcyA9IGZ1bmN0aW9uICh1c2VySWQsIGF1bGFJZCwgcHJvZ3Jlc3MsIHBlcmZvcm1hbmNlKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBhdWxhLCB1c2VyUHJvZ3Jlc3MsIHVzZXJQcm9ncmVzc0luZGV4LCB0b3RhbEZpbmFsaXphZG9zLCB0b3RhbFVzdWFyaW9zLCBtZWRpYVBlcmZvcm1hbmNlOw0KICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHsNCiAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkgew0KICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCBhdWxhTW9kZWxfMS5BdWxhLmZpbmRCeUlkKGF1bGFJZCldOw0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIGF1bGEgPSBfYS5zZW50KCk7DQogICAgICAgICAgICAgICAgaWYgKCFhdWxhKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQXVsYSBuw6NvIGVuY29udHJhZGEnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdXNlclByb2dyZXNzID0gYXVsYS5wcm9ncmVzc1BvclVzdWFyaW8uZmluZChmdW5jdGlvbiAoZWxlbWVudCkgeyByZXR1cm4gZWxlbWVudC51c2VySWQudG9TdHJpbmcoKSA9PT0gdXNlcklkLnRvU3RyaW5nKCk7IH0pOw0KICAgICAgICAgICAgICAgIGlmICh1c2VyUHJvZ3Jlc3MgJiYgdXNlclByb2dyZXNzLnByb2dyZXNzID09PSAxMDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdWxhIGrDoSBmaW5hbGl6YWRhIHBhcmEgZXN0ZSB1c3XDoXJpbywgbsOjbyDDqSBtYWlzIHBvc3PDrXZlbCBhdHVhbGl6YXIgbyBwcm9ncmVzc28uJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHVzZXJQcm9ncmVzc0luZGV4ID0gYXVsYS5wcm9ncmVzc1BvclVzdWFyaW8uZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7IHJldHVybiBlbGVtZW50LnVzZXJJZC50b1N0cmluZygpID09PSB1c2VySWQudG9TdHJpbmcoKTsgfSk7DQogICAgICAgICAgICAgICAgaWYgKHVzZXJQcm9ncmVzc0luZGV4ICE9PSAtMSkgew0KICAgICAgICAgICAgICAgICAgICBhdWxhLnByb2dyZXNzUG9yVXN1YXJpb1t1c2VyUHJvZ3Jlc3NJbmRleF0ucHJvZ3Jlc3MgPSBwcm9ncmVzczsNCiAgICAgICAgICAgICAgICAgICAgYXVsYS5wcm9ncmVzc1BvclVzdWFyaW9bdXNlclByb2dyZXNzSW5kZXhdLnBlcmZvcm1hbmNlID0gcGVyZm9ybWFuY2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBhdWxhLnByb2dyZXNzUG9yVXN1YXJpby5wdXNoKHsgdXNlcklkOiB1c2VySWQsIHByb2dyZXNzOiBwcm9ncmVzcywgcGVyZm9ybWFuY2U6IHBlcmZvcm1hbmNlIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0b3RhbEZpbmFsaXphZG9zID0gYXVsYS5wcm9ncmVzc1BvclVzdWFyaW8uZmlsdGVyKGZ1bmN0aW9uIChlbGVtZW50KSB7IHJldHVybiBlbGVtZW50LnByb2dyZXNzID09PSAxMDA7IH0pLmxlbmd0aDsNCiAgICAgICAgICAgICAgICB0b3RhbFVzdWFyaW9zID0gYXVsYS5wcm9ncmVzc1BvclVzdWFyaW8ubGVuZ3RoOw0KICAgICAgICAgICAgICAgIG1lZGlhUGVyZm9ybWFuY2UgPSB0b3RhbFVzdWFyaW9zID4gMCA/IGF1bGEucHJvZ3Jlc3NQb3JVc3VhcmlvLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBjdXJyKSB7IHJldHVybiBhY2MgKyBjdXJyLnBlcmZvcm1hbmNlOyB9LCAwKSAvIHRvdGFsVXN1YXJpb3MgOiAwOw0KICAgICAgICAgICAgICAgIGF1bGEuZmluYWxpemFkb3MgPSB0b3RhbEZpbmFsaXphZG9zOw0KICAgICAgICAgICAgICAgIGF1bGEubWVkaWFQZXJmb3JtYW5jZSA9IG1lZGlhUGVyZm9ybWFuY2U7DQogICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgYXVsYS5zYXZlKCldOw0KICAgICAgICAgICAgY2FzZSAyOg0KICAgICAgICAgICAgICAgIF9hLnNlbnQoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgYXVsYV07DQogICAgICAgIH0NCiAgICB9KTsNCn0pOyB9Ow0KZXhwb3J0cy5zYXZlUHJvZ3Jlc3MgPSBzYXZlUHJvZ3Jlc3M7DQo="},{"version":3,"file":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\aulas\\aulaService.ts","sourceRoot":"","sources":["C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\aulas\\aulaService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+CAAqD;AACrD,mCAAkC;AAClC,uCAAyD;AACzD,2CAAiD;AACjD,2CAAiD;AACjD,qCAA2C;AAC3C,yCAA+C;AAC/C,2CAAiD;AACjD,gDAA0C;AAG1C,IAAM,MAAM,GAAG,IAAA,oBAAW,GAAE,CAAC;AAE7B,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,WAAI,CAAC,YAAY,CAAC,8BAAiB,CAAC,CAAC,CAAC;AAC5D,MAAM,CAAC,GAAG,CAAC,iBAAiB,EAAE,WAAI,CAAC,YAAY,CAAC,wBAAc,CAAC,CAAC,CAAC;AACjE,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,WAAI,CAAC,YAAY,CAAC,8BAAiB,CAAC,CAAC,CAAC;AAC3D,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,WAAI,CAAC,YAAY,CAAC,4BAAgB,CAAC,CAAC,CAAC;AAC1D,MAAM,CAAC,MAAM,CAAC,iBAAiB,EAAE,WAAI,CAAC,YAAY,CAAC,8BAAiB,CAAC,CAAC,CAAC;AACvE,MAAM,CAAC,IAAI,CAAC,sBAAsB,EAAE,WAAI,CAAC,YAAY,CAAC,kCAAmB,CAAC,CAAC,CAAC;AAE5E,IAAM,IAAI,GAAG,IAAA,qBAAY,EAAC,MAAM,CAAC,CAAC;AAEzB,oBAAI;AAEb,IAAM,UAAU,GAAG,UAAO,IAAiB;;;;oBACxB,qBAAM,gBAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAA;;gBAAlC,QAAQ,GAAG,SAAuB;gBACxC,sBAAO,QAAQ,EAAC;;;KACjB,CAAC;AA+FO,gCAAU;AA7FnB,IAAM,UAAU,GAAG,UAAO,MAAc;;;;oBACjB,qBAAM,gBAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAA;;gBAAnD,YAAY,GAAG,SAAoC;gBACzD,sBAAO,YAAY,EAAC;;;KACrB,CAAC;AA0FmB,gCAAU;AAxF/B,IAAM,OAAO,GAAG,UAAO,MAAc;;;;oBACtB,qBAAM,gBAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAA;;gBAAlC,IAAI,GAAG,SAA2B;gBACxC,sBAAO,IAAI,EAAC;;;KACb,CAAC;AAqF+B,0BAAO;AAnFxC,IAAM,SAAS,GAAG,UAAO,MAOnB;IAPmB,uBAAA,EAAA,WAOnB;;;;;;oBACE,KAAK,GAAQ,EAAE,CAAC;oBAEtB,IAAI,MAAM,CAAC,MAAM,EAAE;wBACjB,KAAK,CAAC,MAAM,GAAG,EAAE,MAAM,EAAE,MAAM,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,CAAC;qBACzD;oBAED,IAAI,MAAM,CAAC,SAAS,EAAE;wBACpB,KAAK,CAAC,SAAS,GAAG,EAAE,MAAM,EAAE,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,GAAG,EAAE,CAAC;qBAC/D;oBAED,IAAI,MAAM,CAAC,QAAQ,KAAK,SAAS,EAAE;wBACjC,KAAK,CAAC,QAAQ,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,QAAQ,EAAE,CAAC;qBAC/C;oBAED,uFAAuF;oBACvF,IAAI,MAAM,CAAC,SAAS,KAAK,SAAS,EAAE;wBAClC,KAAK,CAAC,6BAA6B,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;qBAC9E;oBAED,IAAI,MAAM,CAAC,YAAY,KAAK,SAAS,EAAE;wBACrC,KAAK,CAAC,6BAA6B,CAAC,GAAG,EAAE,IAAI,EAAE,MAAM,CAAC,YAAY,EAAE,CAAC;qBACtE;oBAED,IAAI,MAAM,CAAC,cAAc,KAAK,SAAS,EAAE;wBACvC,KAAK,CAAC,gCAAgC,CAAC,GAAG,EAAE,IAAI,EAAE,MAAM,CAAC,cAAc,EAAE,CAAC;qBAC3E;oBAEa,qBAAM,gBAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAA;;oBAA9B,KAAK,GAAG,SAAsB;oBACpC,sBAAO,KAAK,EAAC;;;;CACd,CAAC;AA8CwC,8BAAS;AA3CnD,IAAM,UAAU,GAAG,UAAO,IAAiB;;;;;gBACjC,MAAM,GAAsB,IAAI,OAA1B,EAAK,YAAY,UAAK,IAAI,EAAlC,UAA2B,CAAF,CAAU;gBAClB,qBAAM,gBAAI,CAAC,iBAAiB,CACjD,MAAM,EACN,EAAE,IAAI,EAAE,YAAY,EAAE,EACtB,EAAE,GAAG,EAAE,IAAI,EAAE,CACd,EAAA;;gBAJK,cAAc,GAAG,SAItB;gBACD,sBAAO,cAAc,EAAC;;;KACvB,CAAC;AAmCmD,gCAAU;AAjC/D,IAAM,YAAY,GAAG,UAAO,MAAc,EAAE,MAAc,EAAE,QAAgB,EAAE,WAAmB;;;;oBAClF,qBAAM,gBAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAA;;gBAAlC,IAAI,GAAG,SAA2B;gBAExC,IAAI,CAAC,IAAI,EAAE;oBACT,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;iBACxC;gBAEK,YAAY,GAAG,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,UAAC,OAAO,IAAK,OAAA,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,KAAK,MAAM,CAAC,QAAQ,EAAE,EAA/C,CAA+C,CAAC,CAAC;gBAEhH,IAAI,YAAY,IAAI,YAAY,CAAC,QAAQ,KAAK,GAAG,EAAE;oBACjD,MAAM,IAAI,KAAK,CAAC,kFAAkF,CAAC,CAAC;iBACrG;gBAEK,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,UAAC,OAAO,IAAK,OAAA,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,KAAK,MAAM,CAAC,QAAQ,EAAE,EAA/C,CAA+C,CAAC,CAAC;gBAE1H,IAAI,iBAAiB,KAAK,CAAC,CAAC,EAAE;oBAC5B,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,CAAC,QAAQ,GAAG,QAAQ,CAAC;oBAC/D,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC,CAAC,WAAW,GAAG,WAAW,CAAC;iBACtE;qBAAM;oBACL,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,MAAM,QAAA,EAAE,QAAQ,UAAA,EAAE,WAAW,aAAA,EAAE,CAAC,CAAC;iBACjE;gBAEK,gBAAgB,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,UAAC,OAAO,IAAK,OAAA,OAAO,CAAC,QAAQ,KAAK,GAAG,EAAxB,CAAwB,CAAC,CAAC,MAAM,CAAC;gBAChG,aAAa,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC;gBAC/C,gBAAgB,GAAG,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,IAAI,IAAK,OAAA,GAAG,GAAG,IAAI,CAAC,WAAW,EAAtB,CAAsB,EAAE,CAAC,CAAC,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;gBAE1I,IAAI,CAAC,WAAW,GAAG,gBAAgB,CAAC;gBACpC,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;gBAEzC,qBAAM,IAAI,CAAC,IAAI,EAAE,EAAA;;gBAAjB,SAAiB,CAAC;gBAClB,sBAAO,IAAI,EAAC;;;KACb,CAAC;AAE+D,oCAAY","sourcesContent":["import { saveProgressHandler } from './saveProgress';\r\nimport { auth } from '@/lib/auth';\r\nimport { buildRouter, buildHandler } from '@/lib/router';\r\nimport { createAulaHandler } from './createAula';\r\nimport { deleteAulaHandler } from './deleteAula';\r\nimport { getAulaHandler } from './getAula';\r\nimport { listAulasHandler } from './listAulas';\r\nimport { updateAulaHandler } from './updateAula';\r\nimport { Aula } from '@/models/aulaModel';\r\nimport { ICreateAula, IUpdateAula } from '@/types/IAula';\r\n\r\nconst router = buildRouter();\r\n\r\nrouter.post('/aulas', auth.verifyLogged(createAulaHandler));\r\nrouter.get('/aulas/{aulaId}', auth.verifyLogged(getAulaHandler));\r\nrouter.put('/aulas', auth.verifyLogged(updateAulaHandler));\r\nrouter.get('/aulas', auth.verifyLogged(listAulasHandler));\r\nrouter.delete('/aulas/{aulaId}', auth.verifyLogged(deleteAulaHandler));\r\nrouter.post('/aulas/{aulaId}/mine', auth.verifyLogged(saveProgressHandler));\r\n\r\nconst main = buildHandler(router);\r\n\r\nexport { main };\r\n\r\nconst createAula = async (data: ICreateAula) => {\r\n  const novaAula = await Aula.create(data);\r\n  return novaAula;\r\n};\r\n\r\nconst deleteAula = async (aulaId: string) => {\r\n  const aulaExcluida = await Aula.findByIdAndDelete(aulaId);\r\n  return aulaExcluida;\r\n};\r\n\r\nconst getAula = async (aulaId: string) => {\r\n  const aula = await Aula.findById(aulaId);\r\n  return aula;\r\n};\r\n\r\nconst listAulas = async (filtro: {\r\n  titulo?: string;\r\n  descricao?: string;\r\n  temVideo?: boolean;\r\n  concluido?: boolean;\r\n  progressoMin?: number;\r\n  performanceMax?: number;\r\n} = {}) => {\r\n  const query: any = {};\r\n\r\n  if (filtro.titulo) {\r\n    query.titulo = { $regex: filtro.titulo, $options: 'i' };\r\n  }\r\n\r\n  if (filtro.descricao) {\r\n    query.descricao = { $regex: filtro.descricao, $options: 'i' };\r\n  }\r\n\r\n  if (filtro.temVideo !== undefined) {\r\n    query.urlVideo = { $exists: filtro.temVideo };\r\n  }\r\n\r\n  // Adicione condições para filtrar por conclusão, progresso mínimo e performance máxima\r\n  if (filtro.concluido !== undefined) {\r\n    query['progressPorUsuario.progress'] = filtro.concluido ? 100 : { $lt: 100 };\r\n  }\r\n\r\n  if (filtro.progressoMin !== undefined) {\r\n    query['progressPorUsuario.progress'] = { $gte: filtro.progressoMin };\r\n  }\r\n\r\n  if (filtro.performanceMax !== undefined) {\r\n    query['progressPorUsuario.performance'] = { $lte: filtro.performanceMax };\r\n  }\r\n\r\n  const aulas = await Aula.find(query);\r\n  return aulas;\r\n};\r\n\r\n\r\nconst updateAula = async (data: IUpdateAula) => {\r\n  const { aulaId, ...atualizacoes } = data;\r\n  const aulaAtualizada = await Aula.findByIdAndUpdate(\r\n    aulaId,\r\n    { $set: atualizacoes },\r\n    { new: true }\r\n  );\r\n  return aulaAtualizada;\r\n};\r\n\r\nconst saveProgress = async (userId: string, aulaId: string, progress: number, performance: number) => {\r\n  const aula = await Aula.findById(aulaId);\r\n\r\n  if (!aula) {\r\n    throw new Error('Aula não encontrada');\r\n  }\r\n\r\n  const userProgress = aula.progressPorUsuario.find((element) => element.userId.toString() === userId.toString());\r\n\r\n  if (userProgress && userProgress.progress === 100) {\r\n    throw new Error('Aula já finalizada para este usuário, não é mais possível atualizar o progresso.');\r\n  }\r\n\r\n  const userProgressIndex = aula.progressPorUsuario.findIndex((element) => element.userId.toString() === userId.toString());\r\n\r\n  if (userProgressIndex !== -1) {\r\n    aula.progressPorUsuario[userProgressIndex].progress = progress;\r\n    aula.progressPorUsuario[userProgressIndex].performance = performance;\r\n  } else {\r\n    aula.progressPorUsuario.push({ userId, progress, performance });\r\n  }\r\n\r\n  const totalFinalizados = aula.progressPorUsuario.filter((element) => element.progress === 100).length;\r\n  const totalUsuarios = aula.progressPorUsuario.length;\r\n  const mediaPerformance = totalUsuarios > 0 ? aula.progressPorUsuario.reduce((acc, curr) => acc + curr.performance, 0) / totalUsuarios : 0;\r\n\r\n  aula.finalizados = totalFinalizados;\r\n  aula.mediaPerformance = mediaPerformance;\r\n\r\n  await aula.save();\r\n  return aula;\r\n};\r\n\r\nexport { createAula, deleteAula, getAula, listAulas, updateAula, saveProgress };\r\n\r\n"]}]}