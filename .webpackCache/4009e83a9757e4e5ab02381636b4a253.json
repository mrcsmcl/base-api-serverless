{"remainingRequest":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js!C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\log\\logService.ts","dependencies":[{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\log\\logService.ts","mtime":1704481060452},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KdmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9DQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQ0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgfSk7DQp9Ow0KdmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHsNCiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnOw0KICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCAidGhyb3ciOiB2ZXJiKDEpLCAicmV0dXJuIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnOw0KICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfQ0KICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHsNCiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsNCiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHsNCiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbInJldHVybiJdIDogb3BbMF0gPyB5WyJ0aHJvdyJdIHx8ICgodCA9IHlbInJldHVybiJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDsNCiAgICAgICAgICAgIGlmICh5ID0gMCwgdCkgb3AgPSBbb3BbMF0gJiAyLCB0LnZhbHVlXTsNCiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9Ow0KICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsNCiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOyBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pOw0KICAgICAgICB9IGNhdGNoIChlKSB7IG9wID0gWzYsIGVdOyB5ID0gMDsgfSBmaW5hbGx5IHsgZiA9IHQgPSAwOyB9DQogICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9Ow0KICAgIH0NCn07DQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOw0KZXhwb3J0cy5sb2dTZXJ2aWNlID0gdm9pZCAwOw0KdmFyIGxvZ01vZGVsXzEgPSByZXF1aXJlKCJAL21vZGVscy9sb2dNb2RlbCIpOw0KdmFyIGxvZ0Vycm9yc18xID0gcmVxdWlyZSgiLi9sb2dFcnJvcnMiKTsNCnZhciBjcmVhdGUgPSBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgbG9nRGI7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgew0KICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGxvZ01vZGVsXzEuTG9nLmNyZWF0ZShkYXRhKV07DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgbG9nRGIgPSBfYS5zZW50KCk7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGxvZ0RiXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywge31dOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107DQogICAgICAgIH0NCiAgICB9KTsNCn0pOyB9Ow0KdmFyIGFkZCA9IGZ1bmN0aW9uICh1c2VyLCBldmVudCwgZGV0YWlsKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBsb2c7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgew0KICAgICAgICBsb2cgPSB7DQogICAgICAgICAgICB1c2VyOiB1c2VyLA0KICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LA0KICAgICAgICAgICAgZGV0YWlsOiBkZXRhaWwNCiAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIGNyZWF0ZShsb2cpXTsNCiAgICB9KTsNCn0pOyB9Ow0KdmFyIGZpbmRCeUlkID0gZnVuY3Rpb24gKGxvZ0lkKSB7IHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgIHZhciBsb2c7DQogICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkgew0KICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7DQogICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIGxvZ01vZGVsXzEuTG9nLmZpbmRCeUlkKGxvZ0lkKV07DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgbG9nID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgIGlmICghbG9nKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IGxvZ0Vycm9yc18xLmxvZ0Vycm9ycy5idWlsZExvZ05vdEZvdW5kRXJyb3IobG9nSWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbG9nXTsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSk7IH07DQp2YXIgbGlzdCA9IGZ1bmN0aW9uIChfYSkgew0KICAgIHZhciBfYiA9IF9hLnNlYXJjaCwgc2VhcmNoID0gX2IgPT09IHZvaWQgMCA/ICcnIDogX2IsIF9jID0gX2EucGFnZSwgcGFnZSA9IF9jID09PSB2b2lkIDAgPyAxIDogX2MsIF9kID0gX2EucGVyUGFnZSwgcGVyUGFnZSA9IF9kID09PSB2b2lkIDAgPyA1MCA6IF9kOw0KICAgIHJldHVybiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbWF4UGFnZXMsIHNraXAsIGZpbHRlciwgdG90YWxTaXplLCBsb2dzOw0KICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9lKSB7DQogICAgICAgICAgICBzd2l0Y2ggKF9lLmxhYmVsKSB7DQogICAgICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgICAgICBtYXhQYWdlcyA9IE1hdGgubWluKCtwZXJQYWdlLCA1MCk7DQogICAgICAgICAgICAgICAgICAgIHNraXAgPSAoK3BhZ2UgLSAxKSAqICtwZXJQYWdlOw0KICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBldmVudDogeyAkcmVnZXg6IHNlYXJjaCB9DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGxvZ01vZGVsXzEuTG9nLmNvdW50RG9jdW1lbnRzKGZpbHRlcildOw0KICAgICAgICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgICAgICAgICAgdG90YWxTaXplID0gX2Uuc2VudCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBsb2dNb2RlbF8xLkxvZy5maW5kKGZpbHRlcikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2tpcChza2lwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5saW1pdChtYXhQYWdlcyldOw0KICAgICAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgICAgICAgbG9ncyA9IF9lLnNlbnQoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHsgbG9nczogbG9ncywgdG90YWxTaXplOiB0b3RhbFNpemUgfV07DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0pOw0KfTsNCnZhciBsb2dTZXJ2aWNlID0gew0KICAgIGNyZWF0ZTogY3JlYXRlLA0KICAgIGFkZDogYWRkLA0KICAgIGxpc3Q6IGxpc3QsDQogICAgZmluZEJ5SWQ6IGZpbmRCeUlkDQp9Ow0KZXhwb3J0cy5sb2dTZXJ2aWNlID0gbG9nU2VydmljZTsNCg=="},{"version":3,"file":"C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\log\\logService.ts","sourceRoot":"","sources":["C:\\Users\\mrcsm\\Desktop\\base-api-serverless\\src\\handlers\\log\\logService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,8CAAuC;AAEvC,yCAAuC;AAEvC,IAAM,MAAM,GAAG,UAAO,IAAU;;;;oBAChB,qBAAM,cAAG,CAAC,MAAM,CAAC,IAAI,CAAC,EAAA;;gBAA9B,KAAK,GAAG,SAAsB;gBAEpC,IAAI;oBACF,sBAAO,KAAK,EAAA;iBACb;gBAAC,OAAO,GAAG,EAAE;oBACZ,sBAAO,EAAE,EAAA;iBACV;;;;KACF,CAAA;AAED,IAAM,GAAG,GAAG,UAAO,IAAI,EAAE,KAAK,EAAE,MAAM;;;QAC9B,GAAG,GAAS;YAChB,IAAI,MAAA;YACJ,KAAK,OAAA;YACL,MAAM,QAAA;SACP,CAAA;QAED,sBAAO,MAAM,CAAC,GAAG,CAAC,EAAA;;KACnB,CAAA;AAED,IAAM,QAAQ,GAAG,UAAO,KAAa;;;;oBACvB,qBAAM,cAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAA;;gBAA/B,GAAG,GAAG,SAAyB;gBAErC,IAAI,CAAC,GAAG,EAAE;oBACR,MAAM,qBAAS,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAA;iBAC7C;gBAED,sBAAO,GAAG,EAAA;;;KACX,CAAA;AAED,IAAM,IAAI,GAAG,UAAO,EAAuC;QAArC,cAAW,EAAX,MAAM,mBAAG,EAAE,KAAA,EAAE,YAAQ,EAAR,IAAI,mBAAG,CAAC,KAAA,EAAE,eAAY,EAAZ,OAAO,mBAAG,EAAE,KAAA;;;;;;oBACjD,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAA;oBACjC,IAAI,GAAG,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,CAAC,OAAO,CAAA;oBAE7B,MAAM,GAAG;wBACb,KAAK,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE;qBAC1B,CAAA;oBACiB,qBAAM,cAAG,CAAC,cAAc,CAAC,MAAM,CAAC,EAAA;;oBAA5C,SAAS,GAAG,SAAgC;oBAErC,qBAAM,cAAG,CAAC,IAAI,CAAC,MAAM,CAAC;6BAChC,IAAI,CAAC,IAAI,CAAC;6BACV,KAAK,CAAC,QAAQ,CAAC,EAAA;;oBAFZ,IAAI,GAAG,SAEK;oBAElB,sBAAO,EAAE,IAAI,MAAA,EAAE,SAAS,WAAA,EAAE,EAAA;;;;CAC3B,CAAA;AAED,IAAM,UAAU,GAAG;IACjB,MAAM,QAAA;IACN,GAAG,KAAA;IACH,IAAI,MAAA;IACJ,QAAQ,UAAA;CACT,CAAA;AAGC,gCAAU","sourcesContent":["import { Log } from '@/models/logModel'\r\nimport { ILog } from '@/types/ILog'\r\nimport { logErrors } from './logErrors'\r\n\r\nconst create = async (data: ILog) => {\r\n  const logDb = await Log.create(data)\r\n\r\n  try {\r\n    return logDb\r\n  } catch (err) {\r\n    return {}\r\n  }\r\n}\r\n\r\nconst add = async (user, event, detail) => {\r\n  const log: ILog = {\r\n    user,\r\n    event,\r\n    detail\r\n  }\r\n\r\n  return create(log)\r\n}\r\n\r\nconst findById = async (logId: string) => {\r\n  const log = await Log.findById(logId)\r\n\r\n  if (!log) {\r\n    throw logErrors.buildLogNotFoundError(logId)\r\n  }\r\n\r\n  return log\r\n}\r\n\r\nconst list = async ({ search = '', page = 1, perPage = 50 }) => {\r\n  const maxPages = Math.min(+perPage, 50)\r\n  const skip = (+page - 1) * +perPage\r\n\r\n  const filter = {\r\n    event: { $regex: search }\r\n  }\r\n  const totalSize = await Log.countDocuments(filter)\r\n\r\n  const logs = await Log.find(filter)\r\n    .skip(skip)\r\n    .limit(maxPages)\r\n\r\n  return { logs, totalSize }\r\n}\r\n\r\nconst logService = {\r\n  create,\r\n  add,\r\n  list,\r\n  findById\r\n}\r\n\r\nexport {\r\n  logService\r\n}\r\n"]}]}